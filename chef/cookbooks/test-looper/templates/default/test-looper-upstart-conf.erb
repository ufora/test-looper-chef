description "test-looper"
author      "ufora"

setuid <%= @service_account %>
setgid <%= @service_account %>

respawn
respawn limit 20 5

env PYTHONPATH=<%= @test_looper_src_dir %>/current
env GIT_SSH=<%= @git_ssh_wrapper %>
env LOG_FILE=<%= @log_file %>
env STACK_FILE=<%= @stack_file %>
env BUILDER_REPO_DIR=<%= @builder_src_dir %>/current


pre-start script
    cd $PYTHONPATH
    git remote update 
    git checkout -f origin/<%= @test_looper_git_branch %>
end script

env INSTALL_DEPENDENCIES_EXPECTED_VERSION=7c69b38771e10af88e992cb2313becfc44e74dab

script
    whoami >> $LOG_FILE
    python $PYTHONPATH/ufora/scripts/test-looper.py $BUILDER_REPO_DIR --testLooperServerPrivateIp=__PRIVATE_IP__ --testLooperServerPort=__PORT__  >> $LOG_FILE 2>&1
end script
